<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>
			文件上传 jquery上传
		</title>
		<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js">
		</script>
		<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/css/bootstrap.min.css">
		<script src="https://cdn.staticfile.org/popper.js/1.12.5/umd/popper.min.js">
		</script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/js/bootstrap.min.js">
		</script>
		<style>
		</style>
	</head>
	<body>
		<div class="container">
			<h2>
				模态框实例
			</h2>
			<!-- 按钮：用于打开模态框 -->
			<button type="button" class="btn btn-primary" data-toggle="modal" id="btn"
			data-target="#myModal">
				打开模态框
			</button>
	
        </div>
        		<!-- 模态框 -->
			<div class="modal fade" id="myModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<!-- 模态框头部 -->
						<div class="modal-header">
							<h4 class="modal-title">
								上传文件
							</h4>
							<button type="button" class="close" data-dismiss="modal">
								&times;
							</button>
						</div>
						<!-- 模态框主体 -->
						<div class="modal-body">
							<div class="container">
								<form enctype="multipart/form-data" method="post">
									<input type="file" id="file1" name="file1" style="margin:5px">
									<div class="progress" style="height:30px">
										<div id="progress" class="progress-bar progress-bar-striped">
										</div>
									</div>
								</form>
								<div id="info">
								</div>
							</div>
						</div>
						<!-- 模态框底部 -->
						<div class="modal-footer">
							<button type="button" class="btn btn-info" onclick="upload()">
								提交
							</button>
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								关闭
							</button>
						</div>
					</div>
				</div>
			</div>
	</body>
	<script>
		function parseFormatNum(number, n) {
			if (n != 0) {
				n = (n > 0 && n <= 20) ? n: 2
			}
			number = parseFloat((number + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";
			var sub_val = number.split(".")[0].split("").reverse();
			var sub_xs = number.split(".")[1];
			var show_html = "";
			for (i = 0; i < sub_val.length; i++) {
				show_html += sub_val[i] + ((i + 1) % 3 == 0 && (i + 1) != sub_val.length ? ",": "")
			}
			if (n == 0) {
				return show_html.split("").reverse().join("")
			} else {
				return show_html.split("").reverse().join("") + "." + sub_xs
			}
		}
		$('#btn').click(function() {
			$('#file1').val('');
			$('#progress').html('');
			$('#progress').css('width', "0%");
			$("#info").html("文件名：" + "<br>文件类型：" + "<br>文件大小：");
		});
		$(':file').change(function() {
            $('#progress').html('');
			$('#progress').css('width', "0%");
			var file = this.files[0];
			var _name = file ? file.name.split('.') : '';
			var name = file ? _name[0] : '';
			var size = file ? parseFormatNum(file.size / 1024 / 1024, 2) + 'MB': '';
			var type = name ? _name[1] : '';
            $("#info").html("文件名：" + name + "<br>文件类型：" + type + "<br>文件大小：" + size);
            
		});

		function upload() {
            if($('#file1').val()){
                var formData = new FormData($('form')[0]);
                formData.append("property", "value");
                $.ajax({
                    url: "http://127.0.0.1/upload",
                    type: "POST",
                    data: formData,
                    xhr: function() {
                        myXhr = $.ajaxSettings.xhr();
                        if (myXhr.upload) {
                            myXhr.upload.addEventListener('progress', progressHandlingFunction, false);
                        }
                        return myXhr;
                    },
                    success: function(result) {
                        setTimeout(function() {
                            if (result == 'done') {
                                alert('上传成功');
                            } else {
                                alert('上传类型有误')
                            }
                        },
                        1000)
                    },
                    contentType: false,
                    processData: false
                });
            }

		}

		function progressHandlingFunction(e) {
			if (e.lengthComputable) {
				$('#progress').attr({
					value: e.loaded,
					max: e.total
				});
				var percent = e.loaded / e.total * 100;
				$('#progress').html(percent.toFixed(0) + "%");
				$('#progress').css('width', percent.toFixed(0) + "%");
			}
		}
	</script>

</html>